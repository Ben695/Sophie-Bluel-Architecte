(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();let P=[];const D=async()=>{const o="https://sophie-bluel-api.web-b.fr/api/works";try{P=await(await fetch(o)).json()}catch(t){console.error("Une erreur s'est produite lors de la génération des projets:",t)}},q=()=>{const o=localStorage.getItem("authToken"),t=gsap.timeline(),e=document.querySelector("header"),l=document.querySelector("#introduction figure img"),n=document.querySelector("#introduction article"),r=document.querySelector("#portfolio");o||(gsap.set(e,{y:"-100%",opacity:0}),gsap.set(l,{y:"-100%",opacity:0}),gsap.set(n,{x:"-100%",opacity:0}),gsap.set(r,{opacity:0,y:"500px"}),t.to(e,{y:"0%",opacity:1,duration:1,ease:"power2.out"}).to(l,{y:"0%",opacity:1,duration:1,ease:"power2.out"},"-=0.5").to(n,{x:"0%",opacity:1,duration:1,ease:"power2.out"},"-=0.5").to(r,{opacity:1,y:"0%",duration:1,ease:"power2.out"}))},M=()=>{document.querySelectorAll("#gallery figure img").forEach(o=>{gsap.set(o,{x:0,y:0,transition:"none"}),o.addEventListener("mousemove",function(t){const e=o.getBoundingClientRect(),l=t.clientX-e.left,n=t.clientY-e.top,r=(l/e.width-.5)*20,d=(n/e.height-.5)*20;gsap.to(o,{x:r,y:d,duration:.5,ease:"power2.out"})}),o.addEventListener("mouseout",function(){gsap.to(o,{x:0,y:0,duration:.5,ease:"power2.out"})})})},z=()=>{const o=document.getElementById("gallery"),t=document.querySelector(".filter"),e=new Set(P.map(r=>r.category.name));e.add("Tous"),[...e].reverse().forEach(r=>{const d=document.createElement("button");d.textContent=r,d.className="btn-filter",t.appendChild(d)});const n=document.querySelectorAll(".btn-filter");n.forEach(r=>{r.addEventListener("click",()=>{const d=r.textContent;o.innerHTML="",P.forEach(y=>{if(d==="Tous"||y.category.name===d){const I=document.createElement("figure"),m=document.createElement("img"),g=document.createElement("figcaption");m.src=y.imageUrl,m.alt=y.title,g.textContent=y.title,I.setAttribute("data-id",y.id),I.appendChild(m),I.appendChild(g),o.appendChild(I)}}),M(),n.forEach(y=>y.classList.remove("active")),r.classList.add("active")})}),n[0].click()};q();const N=()=>{const o=localStorage.getItem("authToken"),t=localStorage.getItem("isLoggedIn"),e=document.getElementById("logout-menu"),l=document.getElementById("login-menu");function n(){l&&(l.style.display="block"),e&&(e.style.display="none")}function r(){l&&(l.style.display="none"),e&&(e.style.display="block")}if(o&&t==="true"){r();const m=document.getElementById("edit-mode"),g=document.getElementById("edit");m&&(m.style.display="flex"),g&&(g.style.display="flex")}else{n();const m=document.getElementById("edit-mode"),g=document.getElementById("edit");m&&(m.style.display="none"),g&&(g.style.display="none")}if(e&&e.addEventListener("click",()=>{localStorage.removeItem("authToken"),localStorage.removeItem("isLoggedIn"),window.location.href="login.html"}),window.location.pathname.endsWith("login.html")){let E=function(f){A.textContent=f,h&&(h.style.display="block")},L=function(){h&&(h.style.display="none")},b=function(){g&&(g.value="")};var d=E,y=L,I=b;const m=document.getElementById("email"),g=document.getElementById("password"),A=document.querySelector(".error-message"),x="https://sophie-bluel-api.web-b.fr/api/users/login",B=document.querySelector(".modal-close"),h=document.getElementById("modal-connexion");m&&m.addEventListener("blur",()=>{const f=m.value;/^[^\s@]+@[^\s@]+\.[^\s@]+/.test(f)?L():E("Adresse e-mail invalide. Veuillez saisir une adresse e-mail valide.")});const S=document.getElementById("connexion");S&&S.addEventListener("click",async()=>{const f=m.value,k=g.value;try{const w=await fetch(x,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:f,password:k})});if(w.ok){const s=await w.json();localStorage.setItem("authToken",s.token),localStorage.setItem("isLoggedIn","true"),window.location.href="index.html"}else E("Identifiants incorrects"),b()}catch(w){console.error("Une erreur s'est produite :",w),E("Une erreur s'est produite. Veuillez réessayer."),b()}}),B&&B.addEventListener("click",()=>{L()}),window.addEventListener("click",f=>{h&&f.target===h&&L()})}},U="https://sophie-bluel-api.web-b.fr/api/works/",T=o=>{document.getElementById(o).style.display="block",document.body.style.overflow="hidden"},C=o=>{document.getElementById(o).style.display="none",document.body.style.overflow="auto"};async function W(o){o.preventDefault(),o.stopPropagation();const t=o.target.closest("figure");if(!t){console.error("Élément figure non trouvé");return}const e=t.getAttribute("data-id");if(!e){console.error("ID du projet non trouvé");return}const l=localStorage.getItem("authToken");if(!l){console.error("Token d'authentification non trouvé");return}try{if(!(await fetch(`${U}${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})).ok)throw new Error(`Erreur lors de la suppression du projet ID ${e}`);console.log(`Projet ID ${e} supprimé avec succès de l'API.`)}catch(d){console.error("Erreur lors de la suppression du projet via l'API:",d);return}t.remove(),console.log(`Projet ID ${e} supprimé de la modale de suppression`);const n=document.getElementById("gallery");if(!n){console.error("Élément #gallery non trouvé");return}const r=n.querySelector(`figure[data-id='${e}']`);if(!r){console.error(`Projet ID ${e} non trouvé dans #gallery`);return}r.remove(),console.log(`Projet ID ${e} supprimé de #gallery`)}const F=async()=>{try{const o=document.getElementById("gallery-remove");P.forEach(t=>{const e=document.createElement("figure");e.setAttribute("data-id",t.id);const l=document.createElement("img");l.src=t.imageUrl,l.alt=t.title,e.appendChild(l);const n=document.createElement("button");n.className="btn-delete",n.type="submit";const r=document.createElement("i");r.className="fa-solid fa-trash",r.style.color="#ffffff",n.appendChild(r),e.appendChild(n),o.appendChild(e)}),o.addEventListener("click",t=>{(t.target.classList.contains("btn-delete")||t.target.parentNode.classList.contains("btn-delete"))&&W(t)})}catch(o){console.error("Erreur lors de la récupération des images de projets dans la modale de suppression:",o)}};document.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("edit"),t=document.getElementById("modal-edit");o&&t&&(o.addEventListener("click",()=>{T("modal-edit")}),document.getElementById("modal-close-edit").addEventListener("click",()=>{C("modal-edit")}),window.addEventListener("click",l=>{l.target===t&&C("modal-edit")}));const e=document.getElementById("btn-addProjects");e&&e.addEventListener("click",()=>{C("modal-edit"),T("modal-add-photo")}),document.getElementById("modal-close-add-photo").addEventListener("click",()=>{C("modal-add-photo")}),window.addEventListener("click",l=>{l.target===document.getElementById("modal-add-photo")&&C("modal-add-photo")})});const V=()=>{function o(e){var l=document.getElementById("modal-form"),n=l.querySelector(".error-form");n.textContent=e,l.style.display="block"}function t(){document.getElementById("name").value="",document.getElementById("email").value="",document.getElementById("message").value=""}document.querySelector(".modal-close").addEventListener("click",function(){document.getElementById("modal-form").style.display="none"}),document.getElementById("modal-form").addEventListener("click",function(e){e.target===e.currentTarget&&(document.getElementById("modal-form").style.display="none")}),document.getElementById("contactForm").addEventListener("submit",function(e){e.preventDefault();var l=document.getElementById("name").value.trim(),n=document.getElementById("email").value.trim(),r=document.getElementById("message").value.trim();if(!l){o("Veuillez entrer votre nom.");return}if(!n){o("Veuillez entrer votre adresse email.");return}if(!r){o("Veuillez entrer votre message.");return}o("Merci! Votre formulaire a été soumis avec succès."),t()})},$=async()=>{let o=document.getElementById("titrePhotos"),t=document.getElementById("optionsList"),e=document.getElementById("valid-addPhotos"),l=document.getElementById("addPhotos"),n=l.querySelector(".btn-addPhotos"),r=l.querySelector(".txt-addPhotos");function d(){console.log("Vérification de la complétion du formulaire..."),console.log("Valeur du titre:",o.value.trim()),console.log("Option sélectionnée:",g());const s=document.getElementById("imageInput");if(console.log("Image input ----------",s),!s){console.error("Element #imageInput not found");return}const i=s.files[0];o.value.trim()!==""&&g()!==null&&i?(e.removeAttribute("disabled"),console.log("Le formulaire est complet, activation du bouton.")):(e.setAttribute("disabled",!0),console.log("Le formulaire n'est pas encore complet..."))}function y(){console.log("Toggling optionsList display..."),t.style.display==="none"||t.style.display===""?(t.style.display="block",console.log("Displaying optionsList")):(t.style.display="none",console.log("Hiding optionsList"))}let I=null;function m(s){var i=document.querySelector(".selector");i.textContent=s.textContent,I=s,document.querySelectorAll(".option").forEach(a=>{a.classList.remove("selected")}),s.classList.add("selected"),console.log("Option choisie:",s.textContent),t.style.display="none";var c=document.createElement("i");c.className="fa-solid fa-chevron-up",c.style.color="#6c6c6c",i.appendChild(c)}function g(){return I}async function A(){console.log("Loading categories from API...");const s="https://sophie-bluel-api.web-b.fr/api/categories";try{const i=await fetch(s);if(!i.ok){console.error("Failed to fetch categories:",i.statusText);return}const c=await i.json();for(console.log("Categories loaded:",c);t.firstChild;)t.removeChild(t.firstChild);c.forEach(a=>{const u=document.createElement("div");u.className="option",u.textContent=a.name,u.dataset.id=a.id,u.addEventListener("click",function(){m(u),d()}),t.appendChild(u),console.log("Option added:",a.name)})}catch(i){console.error("Error loading categories:",i)}}let x=document.querySelector(".valid-work"),B=document.querySelector(".error-work");function h(s){x.textContent=s,B.textContent=""}function E(s){B.textContent=s,x.textContent=""}document.querySelector(".modal-close").addEventListener("click",function(){document.getElementById("modal-form").style.display="none"});async function L(s,i,c){console.log("Début de la fonction addWorkToAPI");const a="https://sophie-bluel-api.web-b.fr/api/works",u=localStorage.getItem("authToken");let p=new FormData;p.append("image",i),p.append("title",s),p.append("category",c);try{const v=await fetch(a,{method:"POST",headers:{Authorization:`Bearer ${u}`},body:p});switch(v.status){case 201:return console.log("Work ajouté avec succès"),h("Work ajouté avec succès"),await v.json();case 400:const j=await v.text();throw E("Erreur 400: "+j),new Error("Erreur 400: "+j);case 401:window.location.href="login.html";break;case 500:throw E("Erreur 500: Le serveur est cassé"),new Error("Erreur 500: Le serveur est cassé");default:const O=await v.text();throw E("Erreur "+v.status+": "+O),new Error("Réponse non réussie de l'API, statut: "+v.status)}}catch(v){throw console.error("Erreur lors de l'appel de l'API",v),E("Une erreur s'est produite. Veuillez réessayer."),v}}o.addEventListener("input",d),t.addEventListener("click",d),document.getElementById("addPhotos").addEventListener("click",function(){document.getElementById("imageInput").click()}),document.getElementById("toggleOptionsElement").addEventListener("click",y),t.style.display="none",await A(),document.getElementById("btn-addProjects").addEventListener("click",function(){const s=document.getElementById("imageInput");s?s.addEventListener("change",function(i){const c=i.target.files[0];if(c){const a=new FileReader;a.onload=function(u){n.style.zIndex="-1",r.style.zIndex="-1";const p=new Image;p.src=u.target.result,p.style.zIndex="1",l.appendChild(p),s.setAttribute("disabled",!0)},a.readAsDataURL(c)}}):console.error("Element #imageInput not found")}),e.addEventListener("click",async()=>{const s=o.value.trim(),i=g().dataset.id,c=document.getElementById("imageInput").files[0];try{const a=await L(s,c,i);console.log("Œuvre ajoutée avec succès:",a),b(a),S(a),o.value="",document.querySelectorAll(".option").forEach(u=>{u.classList.remove("selected")}),document.querySelector(".selector").textContent="",l.querySelector("img")&&l.removeChild(l.querySelector("img")),n.style.zIndex="1",r.style.zIndex="1",e.setAttribute("disabled",!0),setTimeout(()=>{h("")},4e3)}catch(a){console.error("Erreur lors de l'ajout de l'œuvre:",a)}});const b=s=>{try{const i=document.getElementById("gallery-remove"),c=document.createElement("figure");c.setAttribute("data-id",s.id);const a=document.createElement("img");a.src=s.imageUrl,a.alt=s.title,c.appendChild(a);const u=document.createElement("button");u.className="btn-delete",u.type="submit";const p=document.createElement("i");p.className="fa-solid fa-trash",p.style.color="#ffffff",u.appendChild(p),c.appendChild(u),i.appendChild(c),console.log("Image ajoutée à la modale d’ajout.")}catch(i){console.error("Erreur lors de l'ajout de l'image à la modale:",i)}},S=s=>{try{const i=document.getElementById("gallery"),c=document.createElement("figure");c.setAttribute("data-id",s.id);const a=document.createElement("img");a.src=s.imageUrl,a.alt=s.title,c.appendChild(a);const u=document.createElement("figcaption");u.textContent=s.title,c.appendChild(u),i.appendChild(c),console.log("Projet ajouté à la galerie.")}catch(i){console.error("Erreur lors de l'ajout du projet à la galerie:",i)}},f=document.querySelector(".close-modal-addProjects"),k=document.getElementById("modal-add-photo"),w=document.getElementById("modal-edit");f&&k&&w?f.addEventListener("click",()=>{k.style.display="none",w.style.display="block"}):console.error("Un ou plusieurs éléments n'ont pas été trouvés")};document.addEventListener("DOMContentLoaded",async function(){N(),(window.location.pathname.endsWith("index.html")||window.location.pathname==="/")&&(q(),await D(),z(),await F(),V(),await $())});
