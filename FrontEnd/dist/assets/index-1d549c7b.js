(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerPolicy&&(t.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?t.credentials="include":o.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function l(o){if(o.ep)return;o.ep=!0;const t=n(o);fetch(o.href,t)}})();let v=[];const k=async()=>{const s="http://localhost:5678/api/works";try{v=await(await fetch(s)).json()}catch(e){console.error("Une erreur s'est produite lors de la génération des projets:",e)}},C=()=>{const s=document.getElementById("gallery"),e=document.querySelector(".filter"),n=new Set(v.map(t=>t.category.name));n.add("Tous"),[...n].reverse().forEach(t=>{const i=document.createElement("button");i.textContent=t,i.className="btn-filter",e.appendChild(i)});const o=document.querySelectorAll(".btn-filter");o.forEach(t=>{t.addEventListener("click",()=>{const i=t.textContent;s.innerHTML="",v.forEach(u=>{if(i==="Tous"||u.category.name===i){const y=document.createElement("figure"),c=document.createElement("img"),r=document.createElement("figcaption");c.src=u.imageUrl,c.alt=u.title,r.textContent=u.title,y.appendChild(c),y.appendChild(r),s.appendChild(y)}}),o.forEach(u=>u.classList.remove("active")),t.classList.add("active")})}),o[0].click()},b=()=>{const s=localStorage.getItem("authToken"),e=localStorage.getItem("isLoggedIn"),n=document.getElementById("logout-menu"),l=document.getElementById("login-menu");function o(){l&&(l.style.display="block"),n&&(n.style.display="none")}function t(){l&&(l.style.display="none"),n&&(n.style.display="block")}if(s&&e==="true"){t();const c=document.getElementById("edit-mode"),r=document.getElementById("edit");c&&(c.style.display="flex"),r&&(r.style.display="flex")}else{o();const c=document.getElementById("edit-mode"),r=document.getElementById("edit");c&&(c.style.display="none"),r&&(r.style.display="none")}if(n&&n.addEventListener("click",()=>{localStorage.removeItem("authToken"),localStorage.removeItem("isLoggedIn"),window.location.href="login.html"}),window.location.pathname.endsWith("login.html")){let f=function(p){m.textContent=p,d&&(d.style.display="block")},h=function(){d&&(d.style.display="none")},I=function(){r&&(r.value="")};var i=f,u=h,y=I;const c=document.getElementById("email"),r=document.getElementById("password"),m=document.querySelector(".error-message"),a="http://localhost:5678/api/users/login",g=document.querySelector(".modal-close"),d=document.getElementById("modal-connexion");c&&c.addEventListener("blur",()=>{const p=c.value;/^[^\s@]+@[^\s@]+\.[^\s@]+/.test(p)?h():f("Adresse e-mail invalide. Veuillez saisir une adresse e-mail valide.")});const B=document.getElementById("connexion");B&&B.addEventListener("click",async()=>{const p=c.value,w=r.value;try{const E=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p,password:w})});if(E.ok){const L=await E.json();localStorage.setItem("authToken",L.token),localStorage.setItem("isLoggedIn","true"),window.location.href="index.html"}else f("Identifiants incorrects"),I()}catch(E){console.error("Une erreur s'est produite :",E),f("Une erreur s'est produite. Veuillez réessayer."),I()}}),g&&g.addEventListener("click",()=>{h()}),window.addEventListener("click",p=>{d&&p.target===d&&h()})}},P=async()=>{try{const e=document.getElementById("gallery-remove");v.forEach(n=>{const l=document.createElement("figure");l.setAttribute("data-id",n.id),console.log("ID du projet:",n.id);const o=document.createElement("img");o.src=n.imageUrl,o.alt=n.title,l.appendChild(o);const t=document.createElement("button");t.className="btn-delete",t.type="submit";const i=document.createElement("i");i.className="fa-solid fa-trash",i.style.color="#ffffff",t.appendChild(i),l.appendChild(t),e.appendChild(l),console.log("Bouton de suppression généré pour une image.")})}catch(e){console.error("Erreur lors de la récupération des images de projets dans la modale de suppression:",e)}function s(e){e.preventDefault(),e.stopPropagation();const n=e.target.closest("figure"),l=n.getAttribute("data-id"),o=localStorage.getItem("authToken");console.log("Bouton de suppression cliqué"),fetch(`http://localhost:5678/api/works/${l}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}).then(t=>{if(t.ok)n.remove(),console.log(`Projet ID ${l} supprimé avec succès.`);else throw new Error(`Erreur lors de la suppression du projet ID ${l}`)}).catch(t=>{console.error("Erreur lors de la suppression du projet:",t)})}document.getElementById("gallery-remove").addEventListener("click",function(e){(e.target.classList.contains("btn-delete")||e.target.parentNode.classList.contains("btn-delete"))&&s(e)})};document.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("edit"),e=document.getElementById("modal-edit");function n(){e.style.display="block",document.body.style.overflow="hidden"}function l(){e.style.display="none",document.body.style.overflow="auto"}s&&e&&s.addEventListener("click",()=>{n()});const o=document.getElementById("modal-close-edit");o&&o.addEventListener("click",()=>{l()}),window.addEventListener("click",u=>{e&&u.target===e&&l()});function t(){l(),document.getElementById("modal-add-photo").style.display="block",document.body.style.overflow="hidden"}function i(){document.getElementById("modal-add-photo").style.display="none",document.body.style.overflow="auto"}document.getElementById("btn-addProjects").addEventListener("click",function(){t()}),document.getElementById("modal-close-add-photo").addEventListener("click",function(){i()}),window.addEventListener("click",u=>{u.target===document.getElementById("modal-add-photo")&&i()})});const S=()=>{function s(n){var l=document.getElementById("modal-form"),o=l.querySelector(".error-form");o.textContent=n,l.style.display="block"}function e(){document.getElementById("name").value="",document.getElementById("email").value="",document.getElementById("message").value=""}document.querySelector(".modal-close").addEventListener("click",function(){document.getElementById("modal-form").style.display="none"}),document.getElementById("modal-form").addEventListener("click",function(n){n.target===n.currentTarget&&(document.getElementById("modal-form").style.display="none")}),document.getElementById("contactForm").addEventListener("submit",function(n){n.preventDefault();var l=document.getElementById("name").value.trim(),o=document.getElementById("email").value.trim(),t=document.getElementById("message").value.trim();if(!l){s("Veuillez entrer votre nom.");return}if(!o){s("Veuillez entrer votre adresse email.");return}if(!t){s("Veuillez entrer votre message.");return}s("Merci! Votre formulaire a été soumis avec succès."),e()})},A=async()=>{let s=document.getElementById("titrePhotos"),e=document.getElementById("optionsList"),n=document.getElementById("valid-addPhotos");function l(){console.log("Vérification de la complétion du formulaire..."),console.log("Valeur du titre:",s.value.trim()),console.log("Option sélectionnée:",u()),s.value.trim()!==""&&u()!==null?(n.removeAttribute("disabled"),console.log("Le formulaire est complet, activation du bouton.")):(n.setAttribute("disabled",!0),console.log("Le formulaire n'est pas encore complet..."))}function o(){e.style.display==="none"||e.style.display===""?e.style.display="block":e.style.display="none"}let t=null;function i(r){var m=document.querySelector(".selector");m.textContent=r.textContent,t=r,document.querySelectorAll(".option").forEach(g=>{g.classList.remove("selected")}),r.classList.add("selected"),console.log("Option choisie:",r.textContent),e.style.display="none";var a=document.createElement("i");a.className="fa-solid fa-chevron-up",a.style.color="#6c6c6c",m.appendChild(a)}function u(){return t}async function y(){const r="http://localhost:5678/api/categories";let m;try{for(m=await(await fetch(r)).json();e.firstChild;)e.removeChild(e.firstChild);m.forEach(g=>{const d=document.createElement("div");d.className="option",d.textContent=g.name,d.addEventListener("click",function(){i(d),l()}),e.appendChild(d)})}catch(a){console.error("Erreur lors de la récupération des catégories:",a)}}async function c(r,m,a){console.log("Début de la fonction addWorkToAPI");const g="http://localhost:5678/api/works";let d=new FormData;d.append("image",m),d.append("title",r),d.append("category",a);try{const f=await fetch(g,{method:"POST",body:d});if(f.ok)return console.log("Réponse OK de l'API"),await f.json();throw console.error("Réponse non réussie de l'API",await f.text()),new Error("Réponse non réussie de l'API")}catch(f){throw console.error("Erreur lors de l'appel de l'API",f),f}}s.addEventListener("input",l),e.addEventListener("click",l),document.getElementById("addPhotos").addEventListener("click",function(){document.getElementById("imageInput").click()}),document.getElementById("toggleOptionsElement").addEventListener("click",o),document.getElementById("imageInput").addEventListener("change",function(r){const m=r.target.files[0];if(m){const a=new FileReader;a.onload=function(g){for(;document.getElementById("addPhotos").firstChild;)document.getElementById("addPhotos").removeChild(document.getElementById("addPhotos").firstChild);const d=new Image;d.src=g.target.result,document.getElementById("addPhotos").appendChild(d)},a.readAsDataURL(m)}}),n.addEventListener("click",async()=>{console.log("Cliquez sur validAddPhotos");const r=s.value.trim(),m=document.getElementById("imageInput").files[0],a=u().dataset.id;console.log("Title:",r),console.log("Image File:",m),console.log("Category ID:",a);try{await c(r,m,a),alert("Le travail a été ajouté avec succès!")}catch(g){alert("Erreur lors de l'ajout du travail: "+g.message)}}),await y()};document.addEventListener("DOMContentLoaded",async function(){b(),await k(),C(),await P(),S(),await A()});
